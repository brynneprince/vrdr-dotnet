<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VRDR .NET: VRDR .NET</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">VRDR .NET
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="namespace_v_r_d_r.html">VRDR</a> .NET </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a> <a href="https://travis-ci.org/nightingaleproject/vrdr-dotnet"><img src="https://travis-ci.org/nightingaleproject/vrdr-dotnet.svg?branch=master" alt="Build Status" style="pointer-events: none;" class="inline"/></a> <a href="https://www.nuget.org/packages/VRDR"><img src="https://img.shields.io/nuget/v/VRDR?label=VRDR%20%28nuget%29" alt="Nuget" class="inline"/></a> <a href="https://www.nuget.org/packages/VRDR.Messaging"><img src="https://img.shields.io/nuget/v/VRDR.Messaging?label=VRDR.Messaging%20%28nuget%29" alt="Nuget" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md35"></a>
vrdr-dotnet</h1>
<p >This repository includes .NET (C#) code for</p>
<ul>
<li>Producing and consuming the Vital Records Death Reporting (<a class="el" href="namespace_v_r_d_r.html">VRDR</a>) Health Level 7 (HL7) Fast Healthcare Interoperability Resources (FHIR) standard. <a href="http://hl7.org/fhir/us/vrdr/2021Sep/">Click here to view the FHIR Implementation Guide STU2</a>.</li>
<li>Producing and consuming FHIR messages for the exchange of <a class="el" href="namespace_v_r_d_r.html">VRDR</a> documents.</li>
<li>Support for converting <a class="el" href="namespace_v_r_d_r.html">VRDR</a> FHIR records to and from the Inter-Jurisdictional Exchange (IJE) Mortality format, as well as companion microservice for performing conversions.</li>
<li>This codebase covers the subset of the IJE fields listed in this <a href="VRDRdotNETLibraryCoverage.csv">spreadsheet</a>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md36"></a>
Documentation</h2>
<p ><a href="https://nightingaleproject.github.io/vrdr-dotnet/">Doxygen Docs</a></p>
<h2><a class="anchor" id="autotoc_md37"></a>
Versions</h2>
<table class="versionTable" border="3">
</table>
<p ><b><a class="el" href="namespace_v_r_d_r.html">VRDR</a> IG</b> </p>
<p ><b>FHIR</b> </p>
<p ><b>Version</b> </p>
<p ><b><a class="el" href="namespace_v_r_d_r.html">VRDR</a></b> </p>
<p ><b>VRDR.Messaging</b>  </p>
<p >STU1 </p>
<p >R4 </p>
<p >V3.1.1 </p>
<p ><a href="https://www.nuget.org/packages/VRDR/3.1.1">nuget</a> <a href="https://github.com/nightingaleproject/vrdr-dotnet/releases/tag/v3.1.1">github</a> </p>
<p ><a href="https://www.nuget.org/packages/VRDR.Messaging/3.1.1">nuget</a> <a href="https://github.com/nightingaleproject/vital_records_fhir_messaging/releases/download/v3.1.0/fhir_messaging_for_nvss.pdf">github</a>  </p>
<p >STU2 Ballot </p>
<p >R4 </p>
<p >V3.3.0 </p>
<p ><a href="https://www.nuget.org/packages/VRDR/3.3.0">nuget</a> <a href="https://github.com/nightingaleproject/vrdr-dotnet/releases/tag/v3.3.0">github</a> </p>
<p ><a href="https://www.nuget.org/packages/VRDR.Messaging/3.3.0">nuget</a> <a href="https://github.com/nightingaleproject/vital_records_fhir_messaging/releases/download/v3.1.0/fhir_messaging_for_nvss.pdf">github</a>  &lt;/tbody&gt; </p>
<h2><a class="anchor" id="autotoc_md38"></a>
Requirements</h2>
<h3><a class="anchor" id="autotoc_md39"></a>
Development &amp; CLI Requirements</h3>
<ul>
<li>This repository is built using .NET Core 3.1, download <a href="https://dotnet.microsoft.com/download">here</a> </li>
</ul>
<h3><a class="anchor" id="autotoc_md40"></a>
Library Usage</h3>
<ul>
<li>The <a class="el" href="namespace_v_r_d_r.html">VRDR</a> or VRDR.Messaging libraries target .NET Standard 2.0</li>
<li>To check whether your .NET version supports a release, refer to <a href="https://docs.microsoft.com/en-us/dotnet/standard/net-standard#net-implementation-support">the .NET matrix</a>.<ul>
<li>Note whether you are using .NET Core or .NET Framework - see <a href="https://docs.microsoft.com/en-us/archive/msdn-magazine/2017/september/net-standard-demystifying-net-core-and-net-standard">here</a> for distinctions between the .NET implementation options.</li>
<li>Once youâ€™ve determined your .NET implementation type and version, for example you are using .NET Framework 4.6.1, refer to the matrix to verify whether your .NET implementation supports the targeted .NET Standard version.<ul>
<li>Ex. If you are using .NET Framework 4.6.1, you can look at the matrix and see the .NET Framework 4.6.1 supports .NET Standard 2.0 so the tool would be supported.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md41"></a>
Project Organization</h2>
<h3><a class="anchor" id="autotoc_md42"></a>
VRDR</h3>
<p >This directory contains a FHIR Death Record library for consuming and producing <a class="el" href="namespace_v_r_d_r.html">VRDR</a> FHIR. This library also includes support for converting to and from the Inter-Jurisdictional Exchange (IJE) Mortality format.</p>
<p >For API documentation, <a class="el" href="md__v_r_d_r__death_record.html">click here</a>.</p>
<h4><a class="anchor" id="autotoc_md43"></a>
Usage</h4>
<p >This package is published on NuGet, so including it is as easy as: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">ItemGroup</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">  &lt;<span class="keywordtype">PackageReference</span> <span class="keyword">Include</span>=<span class="stringliteral">&quot;VRDR&quot;</span> <span class="keyword">Version</span>=<span class="stringliteral">&quot;3.3.0&quot;</span> /&gt;</div>
<div class="line">  ...</div>
<div class="line">&lt;/<span class="keywordtype">ItemGroup</span>&gt;</div>
</div><!-- fragment --><p >You can also include a locally downloaded copy of the library instead of the NuGet version by referencing <code>DeathRecord.csproj</code> in your project configuration, for example (taken from <a class="el" href="namespace_v_r_d_r_1_1_c_l_i.html">VRDR.CLI</a>): </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">Project</span> <span class="keyword">Sdk</span>=<span class="stringliteral">&quot;Microsoft.NET.Sdk&quot;</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">  &lt;<span class="keywordtype">ItemGroup</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ProjectReference</span> <span class="keyword">Include</span>=<span class="stringliteral">&quot;..\VRDR\DeathRecord.csproj&quot;</span> /&gt;</div>
<div class="line">    ...</div>
<div class="line">  &lt;/<span class="keywordtype">ItemGroup</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">Project</span>&gt;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md44"></a>
Producing Example</h4>
<p >The following snippet is a quick example of producing a from-scratch FHIR <a class="el" href="namespace_v_r_d_r.html">VRDR</a> record using this library, and then printing it out as a JSON string. For a complete example, <a href="https://github.com/nightingaleproject/csharp-fhir-death-record/blob/master/VRDR.CLI/Program.cs#L23">click here</a>. </p><div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code hl_namespace" href="namespace_v_r_d_r.html">VRDR</a>;</div>
<div class="line"> </div>
<div class="line">DeathRecord deathRecord = <span class="keyword">new</span> DeathRecord();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set Death Record ID</span></div>
<div class="line">deathRecord.Identifier = <span class="stringliteral">&quot;42&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add Decedent Given Names</span></div>
<div class="line"><span class="keywordtype">string</span>[] givenNames = { <span class="stringliteral">&quot;First&quot;</span>, <span class="stringliteral">&quot;Middle&quot;</span> };</div>
<div class="line">deathRecord.GivenNames = givenNames;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add Decedent Last Name</span></div>
<div class="line">deathRecord.FamilyName = <span class="stringliteral">&quot;Last&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Cause of Death Part I, Line a</span></div>
<div class="line">deathRecord.COD1A = <span class="stringliteral">&quot;Rupture of myocardium&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Cause of Death Part I Interval, Line a</span></div>
<div class="line">deathRecord.INTERVAL1A = <span class="stringliteral">&quot;Minutes&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Cause of Death Part I Code, Line a</span></div>
<div class="line">Dictionary&lt;string, string&gt; exampleCode = <span class="keyword">new</span> Dictionary&lt;string, string&gt;();</div>
<div class="line">exampleCode.Add(<span class="stringliteral">&quot;code&quot;</span>, <span class="stringliteral">&quot;I21.0&quot;</span>);</div>
<div class="line">exampleCode.Add(<span class="stringliteral">&quot;system&quot;</span>, <span class="stringliteral">&quot;ICD-10&quot;</span>);</div>
<div class="line">exampleCode.Add(<span class="stringliteral">&quot;display&quot;</span>, <span class="stringliteral">&quot;Acute transmural myocardial infarction of anterior wall&quot;</span>);</div>
<div class="line">deathRecord.CODE1A = exampleCode;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add PregnancyStatus</span></div>
<div class="line">Dictionary&lt;string, string&gt; code = <span class="keyword">new</span> Dictionary&lt;string, string&gt;();</div>
<div class="line">code.Add(<span class="stringliteral">&quot;code&quot;</span>, <span class="stringliteral">&quot;PHC1261&quot;</span>);</div>
<div class="line">code.Add(<span class="stringliteral">&quot;system&quot;</span>, <a class="code hl_namespace" href="namespace_v_r_d_r.html">VRDR</a>.<a class="code hl_class" href="class_v_r_d_r_1_1_code_systems.html">CodeSystems</a>.PH_PHINVS_CDC);</div>
<div class="line">code.Add(<span class="stringliteral">&quot;display&quot;</span>, <span class="stringliteral">&quot;Pregnant at the time of death&quot;</span>);</div>
<div class="line">deathRecord.PregnancyStatus = code;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add ExaminerContacted</span></div>
<div class="line">deathRecord.ExaminerContacted = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add DateOfDeath</span></div>
<div class="line">deathRecord.DateOfDeath = <span class="stringliteral">&quot;2018-07-10T10:04:00+00:00&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print record as a JSON string</span></div>
<div class="line">Console.WriteLine(deathRecord.ToJSON());</div>
<div class="ttc" id="aclass_v_r_d_r_1_1_code_systems_html"><div class="ttname"><a href="class_v_r_d_r_1_1_code_systems.html">VRDR.CodeSystems</a></div><div class="ttdef"><b>Definition:</b> CodeSystems.cs:5</div></div>
<div class="ttc" id="anamespace_v_r_d_r_html"><div class="ttname"><a href="namespace_v_r_d_r.html">VRDR</a></div><div class="ttdef"><b>Definition:</b> Program.cs:18</div></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md45"></a>
Consuming Example</h4>
<p >An example of consuming a <a class="el" href="namespace_v_r_d_r.html">VRDR</a> FHIR document (in XML format) using this library, and printing some details from it: </p><div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code hl_namespace" href="namespace_v_r_d_r.html">VRDR</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read in FHIR Death Record XML file as a string</span></div>
<div class="line"><span class="keywordtype">string</span> xml = File.ReadAllText(<span class="stringliteral">&quot;./example_vrdr_fhir_record.xml&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Construct a new DeathRecord object from the FHIR VRDR XML string</span></div>
<div class="line">DeathRecord deathRecord = <span class="keyword">new</span> DeathRecord(xml);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print out some details from the record</span></div>
<div class="line">Console.WriteLine($<span class="stringliteral">&quot;Decedent&#39;s Last Name: {deathRecord.FamilyName}&quot;</span>);</div>
<div class="line"> </div>
<div class="line">Console.WriteLine($<span class="stringliteral">&quot;Date/Time of Death: {deathRecord.DateOfDeath}&quot;</span>);</div>
<div class="line"> </div>
<div class="line">Console.WriteLine($<span class="stringliteral">&quot;Cause of Death Part I, Line a: {deathRecord.COD1A}&quot;</span>);</div>
<div class="line">Console.WriteLine($<span class="stringliteral">&quot;Cause of Death Part I Interval, Line a: {deathRecord.INTERVAL1A}&quot;</span>);</div>
<div class="line">Console.WriteLine($<span class="stringliteral">&quot;Cause of Death Part I Code, Line a: {String.Join(&quot;</span>, <span class="stringliteral">&quot;, deathRecord.CODE1A.Select(x =&gt; x.Key + &quot;</span>=<span class="stringliteral">&quot; + x.Value).ToArray())}&quot;</span>);</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md46"></a>
Helper Methods for Value Sets</h4>
<p >For fields that contain coded values it can involve some extra effort to provide the code, the code system, and the display text. The <a class="el" href="namespace_v_r_d_r.html">VRDR</a> library includes some helper methods to make this easier. For example, here's how to specify the pregnancy status using the long form specifying each of the three necessary values:</p>
<div class="fragment"><div class="line">// Add PregnancyStatus</div>
<div class="line">Dictionary&lt;string, string&gt; code = new Dictionary&lt;string, string&gt;();</div>
<div class="line">code.Add(&quot;code&quot;, &quot;PHC1261&quot;);</div>
<div class="line">code.Add(&quot;system&quot;, VRDR.CodeSystems.PH_PHINVS_CDC);</div>
<div class="line">code.Add(&quot;display&quot;, &quot;Pregnant at the time of death&quot;);</div>
<div class="line">deathRecord.PregnancyStatus = code;</div>
</div><!-- fragment --><p >Here's a simpler way to accomplish the same thing by using the <code>PregnancyStatusHelper</code>:</p>
<div class="fragment"><div class="line">deathRecord.PregnancyStatusHelper = &quot;PHC1261&quot;;</div>
</div><!-- fragment --><p >The helper automatically looks up the correct code system and display string. The following helpers are available to simplify setting coded values:</p>
<ul>
<li>CertificationRoleHelper</li>
<li>MannerOfDeathTypeHelper</li>
<li>MaritalStatusHelper</li>
<li>EducationLevelHelper</li>
<li>DecedentDispositionMethodHelper</li>
<li>DeathLocationTypeHelper</li>
<li>PregnancyStatusHelper</li>
<li>InjuryPlaceHelper</li>
<li>TransportationRoleHelper</li>
</ul>
<h4><a class="anchor" id="autotoc_md47"></a>
FHIR VRDR record to/from IJE Mortality format</h4>
<p >An example of converting a <a class="el" href="namespace_v_r_d_r.html">VRDR</a> FHIR Death Record to an IJE string: </p><div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code hl_namespace" href="namespace_v_r_d_r.html">VRDR</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read in FHIR Death Record XML file as a string</span></div>
<div class="line"><span class="keywordtype">string</span> xml = File.ReadAllText(<span class="stringliteral">&quot;./example_vrdr_fhir_record.xml&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Construct a new DeathRecord object from the string</span></div>
<div class="line">DeathRecord deathRecord = <span class="keyword">new</span> DeathRecord(xml);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create an IJEMortality instance from the DeathRecord</span></div>
<div class="line">IJEMortality ije = <span class="keyword">new</span> IJEMortality(deathRecord);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print out the corresponding IJE version of the DeathRecord</span></div>
<div class="line"><span class="keywordtype">string</span> ijeString = ije.ToString(); <span class="comment">// Converts DeathRecord to IJE</span></div>
<div class="line">Console.WriteLine(ijeString);</div>
</div><!-- fragment --><p >An example of converting an IJE string to a <a class="el" href="namespace_v_r_d_r.html">VRDR</a> FHIR Death Record: </p><div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code hl_namespace" href="namespace_v_r_d_r.html">VRDR</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Construct a new IJEMortality instance from an IJE string</span></div>
<div class="line">IJEMortality ije = <span class="keyword">new</span> IJEMortality(<span class="stringliteral">&quot;...&quot;</span>); <span class="comment">// This will convert the IJE string to a DeathRecord</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Grab the corresponding FHIR DeathRecord</span></div>
<div class="line">DeathRecord deathRecord = ije.ToDeathRecord();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print out the converted FHIR DeathRecord as a JSON string</span></div>
<div class="line">Console.WriteLine(deathRecord.ToJSON());</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md48"></a>
Return Coding</h4>
<p >An example of producing a <code>CodingResponseMessage</code> for handling the returned message from NCHS containing coded causes. For a complete example, <a href="https://github.com/nightingaleproject/vrdr-dotnet/blob/master/doc/Messaging.md#return-coding">click here</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code hl_namespace" href="namespace_v_r_d_r.html">VRDR</a>;</div>
<div class="line"><span class="comment">// Create an empty coding response message</span></div>
<div class="line">CodingResponseMessage message = <span class="keyword">new</span> CodingResponseMessage(<span class="stringliteral">&quot;https://example.org/jurisdiction/endpoint&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign the business identifiers</span></div>
<div class="line">message.CertificateNumber = <span class="stringliteral">&quot;...&quot;</span>;</div>
<div class="line">message.StateAuxiliaryIdentifier = <span class="stringliteral">&quot;...&quot;</span>;</div>
<div class="line">message.NCHSIdentifier = <span class="stringliteral">&quot;...&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create the cause of death coding</span></div>
<div class="line">message.UnderlyingCauseOfDeath = &lt;icd code&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign the record axis codes</span></div>
<div class="line">var recordAxisCodes = <span class="keyword">new</span> List&lt;string&gt;();</div>
<div class="line">recordAxisCodes.Add(&lt;icd code&gt;);</div>
<div class="line">recordAxisCodes.Add(&lt;icd code&gt;);</div>
<div class="line">recordAxisCodes.Add(&lt;icd code&gt;);</div>
<div class="line">recordAxisCodes.Add(&lt;icd code&gt;);</div>
<div class="line">message.CauseOfDeathRecordAxis = recordAxisCodes;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign the entity axis codes</span></div>
<div class="line">var builder = <span class="keyword">new</span> CauseOfDeathEntityAxisBuilder();</div>
<div class="line"><span class="comment">// for each entity axis codes</span></div>
<div class="line">...</div>
<div class="line">builder.Add(&lt;lineNumber&gt;, &lt;positionInLine&gt;, &lt;icd code&gt;);</div>
<div class="line">...</div>
<div class="line"><span class="comment">// end loop</span></div>
<div class="line">message.CauseOfDeathEntityAxis = builder.ToCauseOfDeathEntityAxis();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a JSON representation of the coding response message</span></div>
<div class="line"><span class="keywordtype">string</span> jsonMessage = message.ToJSON();</div>
</div><!-- fragment --><p> Note that the <code>CauseCodes</code> class from previous versions is now obsolete, use the <code>CodingResponseMessage</code> described above instead.</p>
<h3><a class="anchor" id="autotoc_md49"></a>
VRDR.Messaging</h3>
<p >This directory contains classes to create and parse FHIR messages used for Vital Records Death Reporting.</p>
<h4><a class="anchor" id="autotoc_md50"></a>
Usage</h4>
<p >This package is published on NuGet, so including it is as easy as: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">ItemGroup</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">  &lt;<span class="keywordtype">PackageReference</span> <span class="keyword">Include</span>=<span class="stringliteral">&quot;VRDR.Messaging&quot;</span> <span class="keyword">Version</span>=<span class="stringliteral">&quot;3.3.0&quot;</span> /&gt;</div>
<div class="line">  ...</div>
<div class="line">&lt;/<span class="keywordtype">ItemGroup</span>&gt;</div>
</div><!-- fragment --><p >Note that the VRDR.Messaging package automatically includes the <a class="el" href="namespace_v_r_d_r.html">VRDR</a> package, a project file should not reference both.</p>
<p >You can also include a locally downloaded copy of the library instead of the NuGet version by referencing <code>VRDRMessaging.csproj</code> in your project configuration, for example:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">Project</span> <span class="keyword">Sdk</span>=<span class="stringliteral">&quot;Microsoft.NET.Sdk&quot;</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">  &lt;<span class="keywordtype">ItemGroup</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ProjectReference</span> <span class="keyword">Include</span>=<span class="stringliteral">&quot;..\VRDR.Messaging\VRDRMessaging.csproj&quot;</span> /&gt;</div>
<div class="line">    ...</div>
<div class="line">  &lt;/<span class="keywordtype">ItemGroup</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">Project</span>&gt;</div>
</div><!-- fragment --><p >Use of the VRDR.Messaging library to support various message exchange scenarios is described in <a class="el" href="md_doc__messaging.html">`doc/Messaging.md`</a>.</p>
<h3><a class="anchor" id="autotoc_md51"></a>
VRDR.Tests</h3>
<p >This directory contains unit and functional tests for the <a class="el" href="namespace_v_r_d_r.html">VRDR</a> library.</p>
<h4><a class="anchor" id="autotoc_md52"></a>
Usage</h4>
<p >The tests are automatically run by this repositories Travis CI config, but can be run locally by executing the following command in the root project directory: </p><div class="fragment"><div class="line">dotnet test</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md53"></a>
VRDR.CLI</h3>
<p >This directory contains a sample command line interface app that uses the <a class="el" href="namespace_v_r_d_r.html">VRDR</a> library to do a few different things.</p>
<h4><a class="anchor" id="autotoc_md54"></a>
Example Usages</h4>
<div class="fragment"><div class="line"># Builds a fake death record and print out the record as FHIR XML and JSON</div>
<div class="line">dotnet run --project VRDR.CLI</div>
<div class="line"> </div>
<div class="line"># Read in the FHIR XML or JSON death record and print out as IJE</div>
<div class="line">dotnet run --project VRDR.CLI 2ije VRDR.CLI/1.xml</div>
<div class="line"> </div>
<div class="line"># Read in the IJE death record and print out as FHIR XML</div>
<div class="line">dotnet run --project VRDR.CLI ije2xml VRDR.CLI/1.MOR</div>
<div class="line"> </div>
<div class="line"># Read in the IJE death record and print out as FHIR JSON</div>
<div class="line">dotnet run --project VRDR.CLI ije2json VRDR.CLI/1.MOR</div>
<div class="line"> </div>
<div class="line"># Read in the FHIR XML death record and print out as FHIR JSON</div>
<div class="line">dotnet run --project VRDR.CLI xml2json VRDR.CLI/1.xml</div>
<div class="line"> </div>
<div class="line"># Read in the FHIR JSON death record and print out as FHIR XML</div>
<div class="line">dotnet run --project VRDR.CLI json2xml VRDR.CLI/1.json</div>
<div class="line"> </div>
<div class="line"># Read in the FHIR JSON death record, completely disassemble then reassemble, and print as FHIR JSON</div>
<div class="line">dotnet run --project VRDR.CLI json2json VRDR.CLI/1.json</div>
<div class="line"> </div>
<div class="line"># Read in the FHIR XML death record, completely disassemble then reassemble, and print as FHIR XML</div>
<div class="line">dotnet run --project VRDR.CLI xml2xml VRDR.CLI/1.xml</div>
<div class="line"> </div>
<div class="line"># Read in the given FHIR xml (being permissive) and print out the same; useful for doing validation diffs</div>
<div class="line">dotnet run --project VRDR.CLI checkXml VRDR.CLI/1.xml</div>
<div class="line"> </div>
<div class="line"># Read in the given FHIR json (being permissive) and print out the same; useful for doing validation diffs</div>
<div class="line">dotnet run --project VRDR.CLI checkJson VRDR.CLI/1.json</div>
<div class="line"> </div>
<div class="line"># Read in and parse an IJE death record and print out the values for every (supported) field</div>
<div class="line">dotnet run --project VRDR.CLI ije VRDR.CLI/1.MOR</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md55"></a>
VRDR.Client</h3>
<p >This directory contains classes and functions to connect to the <a href="https://github.com/nightingaleproject/Reference-NCHS-API">NVSS API server</a>, authenticate, manage authentication tokens, post records, and retrieve responses. For a full implementation of a client service that uses this library, see the <a href="https://github.com/nightingaleproject/Reference-Client-API">Reference Client Implementation</a>.</p>
<p ><em>This package is not yet published on NuGet.</em></p>
<p >Note that the VRDR.Client package automatically includes the <a class="el" href="namespace_v_r_d_r.html">VRDR</a> package and the <a class="el" href="namespace_v_r_d_r.html">VRDR</a> Messaging package, a project file should not reference both.</p>
<p >You can include a locally downloaded copy of the library instead of the NuGet version by referencing <code>VRDRClient.csproj</code> in your project configuration, for example:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">Project</span> <span class="keyword">Sdk</span>=<span class="stringliteral">&quot;Microsoft.NET.Sdk&quot;</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">  &lt;<span class="keywordtype">ItemGroup</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ProjectReference</span> <span class="keyword">Include</span>=<span class="stringliteral">&quot;..\VRDR.Client\VRDRClient.csproj&quot;</span> /&gt;</div>
<div class="line">    ...</div>
<div class="line">  &lt;/<span class="keywordtype">ItemGroup</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">Project</span>&gt;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md56"></a>
Example Usage</h4>
<p >Authenticate to the NVSS API Server </p><div class="fragment"><div class="line">// Example SAMS credentials</div>
<div class="line">string authUrl = &quot;https://&lt;authServerUrl&gt;.gov/auth/oauth/v2/token&quot;;</div>
<div class="line">string clientId = &quot;Client-id-from-sams&quot;;</div>
<div class="line">string clientSecret = &quot;Client-secret-from-sams&quot;;</div>
<div class="line">string username = &quot;your-sams-username&quot;;</div>
<div class="line">string pass = &quot;your-sams-password&quot;;</div>
<div class="line"> </div>
<div class="line">// ... Create the credentials and client intance</div>
<div class="line">Credentials credentials = new Credentials(authUrl, clientId, clientSecret, username, pass);</div>
<div class="line">string apiUrl = &quot;https://&lt;thenvssapiserverurl&gt;.gov/OSELS/NCHS/NVSSFHIRAPI/&lt;Jurisidction-Id&gt;/Bundles&quot;;</div>
<div class="line">Boolean localDev = false; // false when testing against the NVSS API Server</div>
<div class="line">client = new Client(apiUrl, localDev, credentials);</div>
</div><!-- fragment --><p >POST a FHIR Message to the NVSS API Server with your authenticated client </p><div class="fragment"><div class="line">// ... Create a FHIR Message</div>
<div class="line">BaseMessage msg = new BaseMessage();</div>
<div class="line">Boolean success = client.PostMessageAsync(msg);</div>
<div class="line">// ... handle success or failure</div>
</div><!-- fragment --><p >GET record responses from the NVSS API Server with your authenticated client </p><div class="fragment"><div class="line">// lastUpdated is a timestamp of the last GET request</div>
<div class="line">lastUpdatedStr = lastUpdated.ToString(&quot;yyyy-MM-ddTHH:mm:ss.fffffff&quot;);</div>
<div class="line">var content = client.GetMessageResponsesAsync(lastUpdatedStr);</div>
<div class="line"> </div>
<div class="line">// ...parse the Bundle of Bundles in the content response</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md57"></a>
VRDR.HTTP</h3>
<p >This directory contains a deployable microservice that exposes endpoints for conversion of IJE flat files to DeathRecord JSON or XML, and vice versa.</p>
<p >The current available endpoints to <code>POST</code> to are: </p><div class="fragment"><div class="line">http://&lt;server&gt;:8080/xml   &lt;- For requesting a record as FHIR in XML format</div>
<div class="line">http://&lt;server&gt;:8080/json  &lt;- For requesting a record as FHIR in JSON format</div>
<div class="line">http://&lt;server&gt;:8080/ije   &lt;- For requesting a record as IJE</div>
</div><!-- fragment --><p >Include a <code>Content-Type</code> header indicating what format the record is represented as in the body of the message (e.g. <code>application/fhir+json</code>, <code>application/fhir+xml</code>, or <code>application/ije</code>.).</p>
<h4><a class="anchor" id="autotoc_md58"></a>
Running</h4>
<p >To build a Dockerized version from scratch (from source), you can do so by running (inside the project root directory):</p>
<div class="fragment"><div class="line">dotnet publish</div>
<div class="line">docker build -t vrdr-microservice -f ./VRDR.HTTP/Dockerfile .</div>
<div class="line">docker run -p 8080:8080 vrdr-microservice</div>
</div><!-- fragment --><p >If you prefer not to use Docker, you can run it from the root project directory using <a href="https://dotnet.microsoft.com/download">.NET Core</a>:</p>
<div class="fragment"><div class="line">dotnet run --project VRDR.HTTP</div>
</div><!-- fragment --><p >The service will be listening locally at <code><a href="http://localhost:8080">http://localhost:8080</a></code>.</p>
<h4><a class="anchor" id="autotoc_md59"></a>
Contributing</h4>
<p >Changes related to an upcoming IG version should be merged to the IG-develop-vx.x.x branch. Bug fixes related to the current version should be merged to the master branch and a new release should be created. <br  />
</p>
<p ><a class="anchor" id="autotoc_md60"></a> </p><h5>Create a branch for IG changes:</h5>
<div class="fragment"><div class="line">git fetch origin</div>
<div class="line">git checkout IG-develop-vx.x.x</div>
<div class="line">git pull origin IG-develop-vx.x.x</div>
<div class="line">git checkout -b &lt;your-ticketnumber-branch-name&gt;</div>
<div class="line">&lt;commit-your-IG-related-changes&gt;</div>
<div class="line">&lt;test-with-changes-from-master&gt;</div>
<div class="line">git push origin &lt;your-ticketnumber-branch-name&gt;</div>
</div><!-- fragment --><p> Create merge request to the IG-develop-vx.x.x branch.</p>
<p ><a class="anchor" id="autotoc_md61"></a> </p><h5>Create a branch for bug fixes in master</h5>
<div class="fragment"><div class="line">git checkout master</div>
<div class="line">git pull origin master</div>
<div class="line">git checkout -b &lt;your-ticketnumber-branch-name&gt;</div>
<div class="line">&lt;commit-bug-related-changes&gt;</div>
<div class="line">git push origin &lt;your-ticketnumber-branch-name&gt;</div>
</div><!-- fragment --><p> Create a merge request to the master branch. Finally, merge master into the IG-develop-vx.x.x branch.</p>
<h4><a class="anchor" id="autotoc_md62"></a>
Publishing a Version</h4>
<p >To create a new release of <a class="el" href="namespace_v_r_d_r.html">VRDR</a> on NuGet, bump the version of the <a class="el" href="namespace_v_r_d_r.html">VRDR</a> and VRDR.Messaging listed in the <a href="Directory.Build.props">Directory.Build.props</a> file. Whenever a commit is merged into the master branch that changes the Directory.Build.props file, <a href=".github/workflows/publish.yml">Github Actions</a> will automatically build and publish a new version of the package based on the value specified.</p>
<p >When publishing a new version, remember to update all the version number references in this README as well as creating a GitHub release as needed.</p>
<h2><a class="anchor" id="autotoc_md63"></a>
License</h2>
<p >Copyright 2018, 2019, 2020 The MITRE Corporation</p>
<p >Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
<div class="fragment"><div class="line">http://www.apache.org/licenses/LICENSE-2.0</div>
</div><!-- fragment --><p >Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<h3><a class="anchor" id="autotoc_md64"></a>
Contact Information</h3>
<p >For questions or comments about vrdr-dotnet, please send email to </p><pre class="fragment">cdc-nvss-feedback-list@lists.mitre.org
</pre> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
